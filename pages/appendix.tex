\thispagestyle{empty}
\pagenumbering{gobble}
\addcontentsline{toc}{section}{Bilaga 1. Lua-grammatik}
\section*{Bilaga 1. Lua-grammatik}

\begin{grammar}
  \singlespace\small%
  \fontfamily{lmr}\selectfont

  <chunk> ::= <block>

  <block> ::= \{<stat>\} [<retstat>]

  <stat> ::=  ";"
     \alt <varlist> "=" <explist>
     \alt <functioncall>
     \alt <label>
     \alt "break"
     \alt "goto" Name
     \alt "do" <block> "end"
     \alt "while" <exp> "do" <block> "end"
     \alt "repeat" <block> "until" <exp>
     \alt "if" <exp> "then" <block> \{"elseif" <exp> "then" <block>\} ["else" <block>] "end"
     \alt "for" Name "=" <exp> "," <exp> ["," <exp>] "do" <block> "end"
     \alt "for" <namelist> "in" <explist> "do" <block> "end"
     \alt "function" funcname <funcbody>
     \alt "local" <function> Name <funcbody>
     \alt "local" <namelist> ["=" <explist>]

  <retstat> ::= "return" [<explist>] [";"]

  <label> ::= "::" Name "::"

  <funcname> ::= Name \{"." Name\} [":" Name]

  <varlist> ::= <var> \{"," <var>\}

  <var> ::= Name | <prefixexp> "[" <exp> "]" | <prefixexp> "." Name

  <namelist> ::= Name \{"," Name\}

  <explist> ::= <exp> \{"," <exp>\}

  <exp> ::=  "nil" | "false" | "true" | Number | String | "..." | <functiondef> |
     <prefixexp> | <tableconstructor> | <exp> <binop> <exp> | <unop> <exp>

  <prefixexp> ::= <var> | <functioncall> | "(" <exp> ")"

  <functioncall> ::=  <prefixexp> <args> | <prefixexp> ":" Name <args>

  <args> ::=  "(" [<explist>] ")" | <tableconstructor> | String

  <functiondef> ::= "function" <funcbody>

  <funcbody> ::= "(" [<parlist>] ")" <block> "end"

  <parlist> ::= <namelist> ["," "..."] | "..."

  <tableconstructor> ::= "\{" [<fieldlist>] "\}"

  <fieldlist> ::= <field> \{<fieldsep> <field>\} [<fieldsep>]

  <field> ::= "[" <exp> "]" "=" <exp> | Name "=" <exp> | <exp>

  <fieldsep> ::= "," | ";"

  <binop> ::= "+" | "-" | "*" | "/" | "\textasciicircum" | "\%" | ".." |
     "<" | "<=" | ">" | ">=" | "==" | "~=" |
     "and" | "or"

  <unop> ::= "-" | "not" | "\#"
\end{grammar}

\clearpage
\addcontentsline{toc}{section}{Bilaga 2. Nodantalanalys av LuaMinify}
\section*{Bilaga 2. Nodantal analys av LuaMinify}

Provtagningen är baserad på LuaMinify-projektet och implementerad med Luaparse.

\begin{table}[ht]
  \begin{tabular}{l l}
    Nod-typ & Antal \\
    \hline
    Identifier & 1771 \\
    Literal & 705 \\
    MemberExpression & 339 \\
    CallExpression & 334 \\
    AssignmentStatement & 215 \\
    ElseifClause & 181 \\
    LocalStatement & 174 \\
    TableValue & 172 \\
    BinaryExpression & 162 \\
    IfStatementh & 138 \\
    ReturnStatement & 130 \\
    UnaryExpression & 122 \\
    Comment & 122 \\
    TableConstructorExpression & 101 \\
    IndexExpression & 56 \\
    TableKeyString & 49 \\
    LogicalExpression & 44 \\
    ElseClause & 39 \\
    FunctionDeclaration & 38 \\
    CallStatement & 26 \\
    WhileStatement24TableKey & 20 \\
    BreakStatement & 12 \\
    TableCallExpression & 9 \\
    ForGenericStatement & 6 \\
    ForNumericStatement & 5 \\
    RepeatStatement & 4 \\
    Chunk & 1 \\
    \hline
    Totalt & 4999
  \end{tabular}
\end{table}

\clearpage
\addcontentsline{toc}{section}{Bilaga 3. Lua-grammatik för Jison}
\section*{Bilaga 3. Lua-grammatik för Jison}

\lstinputlisting[title="",keywords=]{figures/tex/lua.jison}

\clearpage
\addcontentsline{toc}{section}{Bilaga 4. Skript för prestandaanalys i JavaScript}
\section*{Bilaga 4. Skript för prestandaanalys i JavaScript}

\lstinputlisting[title="",language=Javascript]{figures/tex/benchmark.js}

\clearpage
\addcontentsline{toc}{section}{Bilaga 5. Skript för prestandaanalys i Lua}
\section*{Bilaga 5. Skript för prestandaanalys i Lua}

\lstinputlisting[title="",language=Lua]{figures/tex/benchmark.lua}

\clearpage
\addcontentsline{toc}{section}{Bilaga 6. ``Bailout''-data}
\section*{Bilaga 6. ``Bailout''-data}

\footnotesize
\begin{verbatim}
Bailout in HGraphBuilder: @"IN": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"ToString": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"toString": inlined runtime function: ClassOf
Bailout in HGraphBuilder: @"ToObject": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"NonNumberToNumber": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"SUB": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"ToNumber": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"DefaultNumber": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"isUnary": SwitchStatement: non-literal switch label
Bailout in HGraphBuilder: @"parsePrimaryExpression": SwitchStatement: non-literal switch label
Bailout in HGraphBuilder: @"forProps": ForInStatement is not fast case
Bailout in HGraphBuilder: @"FILTER_KEY": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"DELETE": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"extend": bad value context for arguments value
Bailout in HGraphBuilder: @"NonStringToString": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"extend": bad value context for arguments value
Bailout in HGraphBuilder: @"TO_NUMBER": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"MUL": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"sqrt": inlined runtime function: MathSqrt
Bailout in HGraphBuilder: @"DefaultString": call to a JavaScript runtime function
Bailout in HGraphBuilder: @"EQUALS": call to a JavaScript runtime function
\end{verbatim}

\clearpage
\addcontentsline{toc}{section}{Bilaga 7. Provtagning 1}
\section*{Bilaga 7. Provtagning 1}

\footnotesize
\begin{verbatim}
Statistical profiling result from v8.log, (5313 ticks, 0 unaccounted, 0 excluded).

 [Shared libraries]:
   ticks  total  nonlib   name
      2    0.0%    0.0%  /usr/lib/libc-2.17.so

 [JavaScript]:
   ticks  total  nonlib   name
    749   14.1%   14.1%  Stub: RegExpExecStub
    703   13.2%   13.2%  LazyCompile: *test native regexp.js:210
    379    7.1%    7.1%  KeyedLoadIC: A keyed load IC from the snapshot
    340    6.4%    6.4%  LazyCompile: *readToken lib/luaparse.js:464
    254    4.8%    4.8%  Stub: CompareICStub {1}
    253    4.8%    4.8%  RegExp: ^[ \\t\\u000B\\u000C\\u0020]$
    238    4.5%    4.5%  RegExp: ^[\\n\\r]$
    233    4.4%    4.4%  Stub: StringAddStub
    216    4.1%    4.1%  LazyCompile: *scanIdentifierOrKeyword lib/luaparse.js:557
    177    3.3%    3.3%  RegExp: ^[a-zA-Z0-9_]$
    158    3.0%    3.0%  Stub: CompareICStub
    128    2.4%    2.4%  RegExp: ^[a-zA-Z_]$
     85    1.6%    1.6%  LazyCompile: *parsePrefixExpression lib/luaparse.js:1502
     70    1.3%    1.3%  LazyCompile: *parseSubExpression lib/luaparse.js:1460
\end{verbatim}

\clearpage
\addcontentsline{toc}{section}{Bilaga 8. Provtagning 2}
\section*{Bilaga 8. Provtagning 2}

\footnotesize
\begin{verbatim}
Statistical profiling result from v8.log, (2688 ticks, 0 unaccounted, 0 excluded).

 [Shared libraries]:
   ticks  total  nonlib   name
      3    0.1%    0.0%  /usr/lib/libc-2.17.so

 [JavaScript]:
   ticks  total  nonlib   name
    338   12.6%   12.6%  LazyCompile: readToken lib/luaparse.js:452
    259    9.6%    9.6%  Stub: CompareICStub {1}
    242    9.0%    9.0%  LazyCompile: *scanIdentifierOrKeyword lib/luaparse.js:547
    212    7.9%    7.9%  Stub: StringAddStub
    121    4.5%    4.5%  LazyCompile: *skipWhiteSpace lib/luaparse.js:530
    119    4.4%    4.4%  KeyedLoadIC: A keyed load IC from the snapshot
     80    3.0%    3.0%  LazyCompile: *parseSubExpression lib/luaparse.js:1447
     65    2.4%    2.4%  LazyCompile: *parsePrefixExpression lib/luaparse.js:1489
     46    1.7%    1.7%  Stub: CompareICStub
     46    1.7%    1.7%  LazyCompile: *scanStringLiteral lib/luaparse.js:597
     42    1.6%    1.6%  LazyCompile: *scanPunctuator lib/luaparse.js:579
     41    1.5%    1.5%  Stub: CallFunctionStub
     41    1.5%    1.5%  LazyCompile: *parsePrimaryExpression lib/luaparse.js:1579
     38    1.4%    1.4%  LazyCompile: *parseStatement lib/luaparse.js:1049

  ...

 [Bottom up (heavy) profile]:
  Note: percentage shows a share of a particular caller in the total
  amount of its parent calls.
  Callers occupying less than 2.0% are not shown.

  ...

    259    9.6%  Stub: CompareICStub {1}
    105   40.5%    LazyCompile: *parseSubExpression lib/luaparse.js:1447
     24   22.9%      LazyCompile: *parseExpression lib/luaparse.js:1415

\end{verbatim}
